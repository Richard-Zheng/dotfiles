_zdir=${ZDOTDIR:-$HOME}
ZSH_CACHE="${XDG_CACHE_HOME:-$HOME/.cache}/zsh/"
if [[ ! -d $ZSH_CACHE ]]; then
  mkdir -p $ZSH_CACHE 
fi

# Bootstrap zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"

# zinit plugins
zinit ice depth=1; zinit light romkatv/powerlevel10k
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-autosuggestions
zinit light none9632/zsh-sudo
zinit snippet PZT::modules/pacman/init.zsh

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# For ICS PA
export NEMU_HOME=/home/frain/ics2024/nemu
export AM_HOME=/home/frain/ics2024/abstract-machine

# History file
HISTFILE=~/.zsh_history
HISTSIZE=1000
SAVEHIST=1000
## History command configuration
setopt extended_history       # record timestamp of command in HISTFILE
setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE
setopt hist_ignore_dups       # ignore duplicated commands history list
setopt hist_ignore_space      # ignore commands that start with space
setopt hist_verify            # show command with history expansion to user before running it
setopt share_history          # share history between shells
# use OS fcntl file lock
setopt hist_fcntl_lock 2>/dev/null

# The following lines were added by compinstall
zstyle :compinstall filename "$_zdir/.zshrc"
if [[ -z $SUDO_UID ]]; then
  fpath=($_zdir/.zsh/Completion $_zdir/.zsh/functions $fpath)
fi
autoload -Uz compinit
ZSH_COMPDUMP="$ZSH_CACHE/.zcompdump-${ZSH_VERSION}"
compinit -d $ZSH_COMPDUMP
# End of lines added by compinstall

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f $_zdir/.p10k.zsh ]] || source $_zdir/.p10k.zsh

unsetopt beep
bindkey -e
# don't have to spell out cd
setopt autocd
# cd dir stack
setopt auto_pushd
setopt pushd_ignore_dups
setopt pushd_minus
# allow comments in interactive mode
setopt interactive_comments
# use # ^ ~ in patterns for filename generation
setopt extended_glob
# completion list columns can have diff widths
setopt list_packed
# path/file name completion on -file=/sth arguments
setopt magic_equal_subst
# show option state when run 'setopt'
setopt ksh_option_print
# don't slow down background jobs
setopt no_bg_nice
# enable ^S/^Q to be keymapped
setopt noflowcontrol; stty -ixon

# Change Xft.dpi instantly
# Usage: dpi <number>
function dpi() {
    sed -i -E s/^Xft.dpi:.\*/Xft.dpi:$1/ ~/.Xresources && xrdb ~/.Xresources && i3-msg restart
}
